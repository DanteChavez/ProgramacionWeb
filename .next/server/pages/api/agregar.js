"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "pages/api/agregar";
exports.ids = ["pages/api/agregar"];
exports.modules = {

/***/ "googleapis":
/*!*****************************!*\
  !*** external "googleapis" ***!
  \*****************************/
/***/ ((module) => {

module.exports = require("googleapis");

/***/ }),

/***/ "jsonwebtoken":
/*!*******************************!*\
  !*** external "jsonwebtoken" ***!
  \*******************************/
/***/ ((module) => {

module.exports = require("jsonwebtoken");

/***/ }),

/***/ "mongodb":
/*!**************************!*\
  !*** external "mongodb" ***!
  \**************************/
/***/ ((module) => {

module.exports = require("mongodb");

/***/ }),

/***/ "next/dist/compiled/next-server/pages-api.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/pages-api.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/pages-api.runtime.dev.js");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "formidable":
/*!*****************************!*\
  !*** external "formidable" ***!
  \*****************************/
/***/ ((module) => {

module.exports = import("formidable");;

/***/ }),

/***/ "(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fagregar&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cagregar.js&middlewareConfigBase64=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fagregar&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cagregar.js&middlewareConfigBase64=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   routeModule: () => (/* binding */ routeModule)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/pages-api/module.compiled */ \"(api)/./node_modules/next/dist/server/route-modules/pages-api/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(api)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/build/templates/helpers */ \"(api)/./node_modules/next/dist/build/templates/helpers.js\");\n/* harmony import */ var _pages_api_agregar_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./pages\\api\\agregar.js */ \"(api)/./pages/api/agregar.js\");\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([_pages_api_agregar_js__WEBPACK_IMPORTED_MODULE_3__]);\n_pages_api_agregar_js__WEBPACK_IMPORTED_MODULE_3__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n// Import the userland code.\n\n// Re-export the handler (should be the default export).\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_agregar_js__WEBPACK_IMPORTED_MODULE_3__, 'default'));\n// Re-export config.\nconst config = (0,next_dist_build_templates_helpers__WEBPACK_IMPORTED_MODULE_2__.hoist)(_pages_api_agregar_js__WEBPACK_IMPORTED_MODULE_3__, 'config');\n// Create and export the route module that will be consumed.\nconst routeModule = new next_dist_server_route_modules_pages_api_module_compiled__WEBPACK_IMPORTED_MODULE_0__.PagesAPIRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.PAGES_API,\n        page: \"/api/agregar\",\n        pathname: \"/api/agregar\",\n        // The following aren't used in production.\n        bundlePath: '',\n        filename: ''\n    },\n    userland: _pages_api_agregar_js__WEBPACK_IMPORTED_MODULE_3__\n});\n\n//# sourceMappingURL=pages-api.js.map\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFwaSkvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LXJvdXRlLWxvYWRlci9pbmRleC5qcz9raW5kPVBBR0VTX0FQSSZwYWdlPSUyRmFwaSUyRmFncmVnYXImcHJlZmVycmVkUmVnaW9uPSZhYnNvbHV0ZVBhZ2VQYXRoPS4lMkZwYWdlcyU1Q2FwaSU1Q2FncmVnYXIuanMmbWlkZGxld2FyZUNvbmZpZ0Jhc2U2ND1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ0U7QUFDMUQ7QUFDcUQ7QUFDckQ7QUFDQSxpRUFBZSx3RUFBSyxDQUFDLGtEQUFRLFlBQVksRUFBQztBQUMxQztBQUNPLGVBQWUsd0VBQUssQ0FBQyxrREFBUTtBQUNwQztBQUNPLHdCQUF3Qix5R0FBbUI7QUFDbEQ7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0wsWUFBWTtBQUNaLENBQUM7O0FBRUQscUMiLCJzb3VyY2VzIjpbIiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQYWdlc0FQSVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvcm91dGUtbW9kdWxlcy9wYWdlcy1hcGkvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBob2lzdCB9IGZyb20gXCJuZXh0L2Rpc3QvYnVpbGQvdGVtcGxhdGVzL2hlbHBlcnNcIjtcbi8vIEltcG9ydCB0aGUgdXNlcmxhbmQgY29kZS5cbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIuL3BhZ2VzXFxcXGFwaVxcXFxhZ3JlZ2FyLmpzXCI7XG4vLyBSZS1leHBvcnQgdGhlIGhhbmRsZXIgKHNob3VsZCBiZSB0aGUgZGVmYXVsdCBleHBvcnQpLlxuZXhwb3J0IGRlZmF1bHQgaG9pc3QodXNlcmxhbmQsICdkZWZhdWx0Jyk7XG4vLyBSZS1leHBvcnQgY29uZmlnLlxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IGhvaXN0KHVzZXJsYW5kLCAnY29uZmlnJyk7XG4vLyBDcmVhdGUgYW5kIGV4cG9ydCB0aGUgcm91dGUgbW9kdWxlIHRoYXQgd2lsbCBiZSBjb25zdW1lZC5cbmV4cG9ydCBjb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBQYWdlc0FQSVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5QQUdFU19BUEksXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9hZ3JlZ2FyXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvYWdyZWdhclwiLFxuICAgICAgICAvLyBUaGUgZm9sbG93aW5nIGFyZW4ndCB1c2VkIGluIHByb2R1Y3Rpb24uXG4gICAgICAgIGJ1bmRsZVBhdGg6ICcnLFxuICAgICAgICBmaWxlbmFtZTogJydcbiAgICB9LFxuICAgIHVzZXJsYW5kXG59KTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9cGFnZXMtYXBpLmpzLm1hcCJdLCJuYW1lcyI6W10sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fagregar&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cagregar.js&middlewareConfigBase64=e30%3D!\n");

/***/ }),

/***/ "(api)/./pages/api/agregar.js":
/*!******************************!*\
  !*** ./pages/api/agregar.js ***!
  \******************************/
/***/ ((module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.a(module, async (__webpack_handle_async_dependencies__, __webpack_async_result__) => { try {\n__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   config: () => (/* binding */ config),\n/* harmony export */   \"default\": () => (/* binding */ handler)\n/* harmony export */ });\n/* harmony import */ var formidable__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! formidable */ \"formidable\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! mongodb */ \"mongodb\");\n/* harmony import */ var mongodb__WEBPACK_IMPORTED_MODULE_3___default = /*#__PURE__*/__webpack_require__.n(mongodb__WEBPACK_IMPORTED_MODULE_3__);\n/* harmony import */ var googleapis__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! googleapis */ \"googleapis\");\n/* harmony import */ var googleapis__WEBPACK_IMPORTED_MODULE_4___default = /*#__PURE__*/__webpack_require__.n(googleapis__WEBPACK_IMPORTED_MODULE_4__);\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! jsonwebtoken */ \"jsonwebtoken\");\n/* harmony import */ var jsonwebtoken__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(jsonwebtoken__WEBPACK_IMPORTED_MODULE_5__);\nvar __webpack_async_dependencies__ = __webpack_handle_async_dependencies__([formidable__WEBPACK_IMPORTED_MODULE_0__]);\nformidable__WEBPACK_IMPORTED_MODULE_0__ = (__webpack_async_dependencies__.then ? (await __webpack_async_dependencies__)() : __webpack_async_dependencies__)[0];\n\n\n\n\n\n\nconst SECRET_KEY = '*****';\nconst config = {\n    api: {\n        bodyParser: false\n    }\n};\nconst uri = \"mongodb://localhost:27017\";\nconst client = new mongodb__WEBPACK_IMPORTED_MODULE_3__.MongoClient(uri);\nlet db;\nconst tempDir = path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), 'tmp');\n// Crear el directorio si no existe\nif (!fs__WEBPACK_IMPORTED_MODULE_2___default().existsSync(tempDir)) {\n    fs__WEBPACK_IMPORTED_MODULE_2___default().mkdirSync(tempDir, {\n        recursive: true\n    });\n}\n// Configurar autenticación para Google Drive\nconst auth = new googleapis__WEBPACK_IMPORTED_MODULE_4__.google.auth.GoogleAuth({\n    keyFile: path__WEBPACK_IMPORTED_MODULE_1___default().join(process.cwd(), './pages/api/service_account.json'),\n    scopes: [\n        'https://www.googleapis.com/auth/drive'\n    ]\n});\nconst drive = googleapis__WEBPACK_IMPORTED_MODULE_4__.google.drive({\n    version: 'v3',\n    auth\n});\nasync function connectToDatabase() {\n    if (!db) {\n        await client.connect();\n        console.log(\"Conectado a MongoDB\");\n        db = client.db(\"admin\");\n    }\n    return db;\n}\nasync function uploadToGoogleDrive(filePath, fileName) {\n    const fileMetadata = {\n        name: fileName,\n        parents: '1EkEzfVMnl1lDWBGKxBB192BjEbckse9R'\n    };\n    const media = {\n        mimeType: 'application/pdf',\n        body: fs__WEBPACK_IMPORTED_MODULE_2___default().createReadStream(filePath)\n    };\n    console.log(\"filePath: \\t\", filePath);\n    console.log(\"fileMetadata.parents: \\t\", fileMetadata.parents);\n    const file = await drive.files.create({\n        resource: fileMetadata,\n        media,\n        fields: 'id, webViewLink'\n    });\n    console.log(\"Archivo subido exitosamente:\");\n    console.log(\"ID del archivo:\", file.data.id);\n    console.log(\"Nombre del archivo:\", file.data.name);\n    console.log(\"Enlace para ver el archivo:\", file.data.webViewLink);\n    console.log(\"Enlace para descargar el archivo:\", file.data.webContentLink);\n    await drive.permissions.create({\n        fileId: file.data.id,\n        requestBody: {\n            role: 'reader',\n            type: 'anyone'\n        }\n    });\n    // Devuelve el enlace público al archivo\n    return file.data.id;\n}\nasync function handler(req, res) {\n    if (req.method === 'POST') {\n        const form = (0,formidable__WEBPACK_IMPORTED_MODULE_0__[\"default\"])({\n            uploadDir: tempDir,\n            keepExtensions: true\n        });\n        form.parse(req, async (err, fields, files)=>{\n            if (err) {\n                console.error(\"Error al procesar el archivo:\", err);\n                return res.status(500).json({\n                    success: false,\n                    error: \"Error al procesar el archivo\"\n                });\n            }\n            try {\n                const { nombremateria, nombrecurso, nombrematerial, tipo, descripcion, fecha, categoria, token } = fields;\n                if (token[0] == null) {\n                    console.log(\"no esta logeado\");\n                    return res.status(400).json({\n                        success: false,\n                        error: \"Debe logearse para subir archivos\"\n                    });\n                } else {\n                    //console.log(\"AASDASDDS\");\n                    const decoded = jsonwebtoken__WEBPACK_IMPORTED_MODULE_5___default().verify(token[0], SECRET_KEY);\n                    //console.log(decoded.permisos);\n                    // no se programar\n                    if (decoded.permisos == 0) {\n                        console.log(\"permisos = 0\");\n                    } else if (decoded.permisos == 1) {\n                        console.log(\"permisos = 1\");\n                    } else {\n                        console.log(\"no\");\n                        return res.status(400).json({\n                            success: false,\n                            error: \"Debe logearse para subir archivos\"\n                        });\n                    }\n                    //console.log(\"exito\");\n                    console.log(\"exito\");\n                    if (!nombremateria || !nombrecurso || !nombrematerial || !tipo || !descripcion || !fecha || !categoria || !files.archivo) {\n                        return res.status(400).json({\n                            success: false,\n                            error: \"Todos los campos son obligatorios\"\n                        });\n                    }\n                    console.log(\"exito22\");\n                    const archivoSubido = files.archivo[0];\n                    const filePath = archivoSubido.filepath; // Ruta del archivo temporal\n                    const randomFileName = `${Date.now()}-${archivoSubido.originalFilename}`;\n                    // Subir archivo a Google Drive\n                    // Conectar a la base de datos\n                    const database = await connectToDatabase();\n                    const materiasCollection = database.collection(\"material\");\n                    // Validar materia y curso\n                    const materia = await materiasCollection.findOne({\n                        nombremateria: nombremateria[0]\n                    });\n                    if (!materia) {\n                        console.log(\"Materia no encontrado\");\n                        return res.status(404).json({\n                            success: false,\n                            error: \"Materia no encontrada\"\n                        });\n                    }\n                    const curso = await materiasCollection.findOne({\n                        \"nombremateria\": nombremateria[0],\n                        \"cursos.nombrecurso\": nombrecurso[0]\n                    });\n                    if (!curso) {\n                        console.log(\"Curso no encontrado\");\n                        return res.status(404).json({\n                            success: false,\n                            error: \"Curso no encontrado\"\n                        });\n                    }\n                    // Obtener conteo actual de materiales\n                    const conteo = await materiasCollection.aggregate([\n                        {\n                            $match: {\n                                \"nombremateria\": nombremateria[0]\n                            }\n                        },\n                        {\n                            $unwind: \"$cursos\"\n                        },\n                        {\n                            $match: {\n                                \"cursos.nombrecurso\": nombrecurso[0]\n                            }\n                        },\n                        {\n                            $unwind: \"$cursos.materiales\"\n                        },\n                        {\n                            $count: \"total_materiales\"\n                        }\n                    ]).toArray();\n                    const totalnumero = conteo.length > 0 ? conteo[0].total_materiales : 0;\n                    const googleDriveLink = await uploadToGoogleDrive(filePath, randomFileName);\n                    // Crear el nuevo material\n                    const nuevoMaterial = {\n                        idmaterial: totalnumero + 1,\n                        nombrematerial: nombrematerial[0],\n                        tipo: tipo[0],\n                        descripcion: descripcion[0],\n                        fecha: fecha[0],\n                        aprovado: false,\n                        idmateria: materia.idmateria,\n                        ruta: googleDriveLink,\n                        categoria: categoria[0]\n                    };\n                    // Añadir el material a la base de datos\n                    const anadir = await materiasCollection.updateOne({\n                        \"nombremateria\": nombremateria[0],\n                        \"cursos.nombrecurso\": nombrecurso[0]\n                    }, {\n                        $push: {\n                            \"cursos.$.materiales\": nuevoMaterial\n                        }\n                    });\n                    //console.log(\"################################\\n\\n\\n\\n\\n\");\n                    //console.log(\"SOLICITUD\");\n                    //console.log(\"################################\\n\\n\\n\\n\\n\");\n                    if (anadir.modifiedCount > 0) {\n                        res.status(201).json({\n                            success: true,\n                            message: \"Material agregado exitosamente\",\n                            material: {\n                                nombrematerial,\n                                tipo,\n                                descripcion,\n                                fecha,\n                                categoria,\n                                ruta: googleDriveLink\n                            }\n                        });\n                    } else {\n                        return res.status(500).json({\n                            success: false,\n                            error: \"Error al añadir material\"\n                        });\n                    }\n                }\n            } catch (error) {\n                console.error(\"Error al agregar material:\", error);\n                res.status(500).json({\n                    success: false,\n                    error: \"Error interno del servidor\"\n                });\n            }\n        });\n    } else {\n        res.status(405).json({\n            error: 'Método no permitido'\n        });\n    }\n}\n\n__webpack_async_result__();\n} catch(e) { __webpack_async_result__(e); } });//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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UW1DLEtBQUssQ0FBQyw4QkFBOEJBO2dCQUM1Q1AsSUFBSVEsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztvQkFBRUMsU0FBUztvQkFBT0gsT0FBTztnQkFBNkI7WUFDL0U7UUFDSjtJQUNKLE9BQU87UUFDSFAsSUFBSVEsTUFBTSxDQUFDLEtBQUtDLElBQUksQ0FBQztZQUFFRixPQUFPO1FBQXNCO0lBQ3hEO0FBQ0oiLCJzb3VyY2VzIjpbIkM6XFxVc2Vyc1xcZGFudGVcXE9uZURyaXZlXFxFc2NyaXRvcmlvXFxVTklWRVJTSURBRCAyXFxkZXNhcnJvbGxvIHdlYlxcZW50cmVnYSAzXFx3ZWIgLSBjb3BpYVxccGFnZXNcXGFwaVxcYWdyZWdhci5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZm9ybWlkYWJsZSBmcm9tICdmb3JtaWRhYmxlJztcclxuaW1wb3J0IHBhdGggZnJvbSAncGF0aCc7XHJcbmltcG9ydCBmcyBmcm9tICdmcyc7XHJcbmltcG9ydCB7IE1vbmdvQ2xpZW50IH0gZnJvbSAnbW9uZ29kYic7XHJcbmltcG9ydCB7IGdvb2dsZSB9IGZyb20gJ2dvb2dsZWFwaXMnO1xyXG5pbXBvcnQgand0IGZyb20gJ2pzb253ZWJ0b2tlbic7XHJcbmNvbnN0IFNFQ1JFVF9LRVkgPSAnKioqKionOyBcclxuZXhwb3J0IGNvbnN0IGNvbmZpZyA9IHtcclxuICAgIGFwaToge1xyXG4gICAgICAgIGJvZHlQYXJzZXI6IGZhbHNlLCAvLyBEZXNoYWJpbGl0YXIgZWwgcGFyc2VyIHBvciBkZWZlY3RvXHJcbiAgICB9LFxyXG59O1xyXG5cclxuY29uc3QgdXJpID0gXCJtb25nb2RiOi8vbG9jYWxob3N0OjI3MDE3XCI7XHJcbmNvbnN0IGNsaWVudCA9IG5ldyBNb25nb0NsaWVudCh1cmkpO1xyXG5sZXQgZGI7XHJcbmNvbnN0IHRlbXBEaXIgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3RtcCcpO1xyXG5cclxuLy8gQ3JlYXIgZWwgZGlyZWN0b3JpbyBzaSBubyBleGlzdGVcclxuaWYgKCFmcy5leGlzdHNTeW5jKHRlbXBEaXIpKSB7XHJcbiAgICBmcy5ta2RpclN5bmModGVtcERpciwgeyByZWN1cnNpdmU6IHRydWUgfSk7XHJcbn1cclxuXHJcbi8vIENvbmZpZ3VyYXIgYXV0ZW50aWNhY2nDs24gcGFyYSBHb29nbGUgRHJpdmVcclxuY29uc3QgYXV0aCA9IG5ldyBnb29nbGUuYXV0aC5Hb29nbGVBdXRoKHtcclxuICAgIGtleUZpbGU6IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAnLi9wYWdlcy9hcGkvc2VydmljZV9hY2NvdW50Lmpzb24nKSwgLy8gY2xhdmUgcHJpdmFkYSBubyB0YW4gcHJpdmFkYVxyXG4gICAgc2NvcGVzOiBbJ2h0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL2F1dGgvZHJpdmUnXSxcclxufSk7XHJcbmNvbnN0IGRyaXZlID0gZ29vZ2xlLmRyaXZlKHsgdmVyc2lvbjogJ3YzJywgYXV0aCB9KTtcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIGNvbm5lY3RUb0RhdGFiYXNlKCkge1xyXG4gICAgaWYgKCFkYikge1xyXG4gICAgICAgIGF3YWl0IGNsaWVudC5jb25uZWN0KCk7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJDb25lY3RhZG8gYSBNb25nb0RCXCIpO1xyXG4gICAgICAgIGRiID0gY2xpZW50LmRiKFwiYWRtaW5cIik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gZGI7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHVwbG9hZFRvR29vZ2xlRHJpdmUoZmlsZVBhdGgsIGZpbGVOYW1lKSB7XHJcbiAgICBcclxuICAgIGNvbnN0IGZpbGVNZXRhZGF0YSA9IHtcclxuICAgICAgICBuYW1lOiBmaWxlTmFtZSwgLy8gTm9tYnJlIGRlbCBhcmNoaXZvIGVuIEdvb2dsZSBEcml2ZVxyXG4gICAgICAgIHBhcmVudHM6ICcxRWtFemZWTW5sMWxEV0JHS3hCQjE5MkJqRWJja3NlOVInLCAvLyBuaSBpZGVhIGEgcXVlIGNhcnBldGEgbG8gZXN0b3kgc3ViaWVuZG8gZW4gZWwgZHJpdmUsIG5vIG1vZGlmaWNhci4gcmVzcGFsZG86IDFFa0V6ZlZNbmwxbERXQkdLeEJCMTkyQmpFYmNrc2U5UlxyXG4gICAgfTtcclxuICAgIGNvbnN0IG1lZGlhID0ge1xyXG4gICAgICAgIG1pbWVUeXBlOiAnYXBwbGljYXRpb24vcGRmJywgLy8gQ2FtYmlhIHNlZ8O6biBlbCB0aXBvIGRlIGFyY2hpdm9cclxuICAgICAgICBib2R5OiBmcy5jcmVhdGVSZWFkU3RyZWFtKGZpbGVQYXRoKSxcclxuICAgIH07XHJcbiAgICBjb25zb2xlLmxvZyhcImZpbGVQYXRoOiBcXHRcIiwgZmlsZVBhdGgpO1xyXG4gICAgY29uc29sZS5sb2coXCJmaWxlTWV0YWRhdGEucGFyZW50czogXFx0XCIsIGZpbGVNZXRhZGF0YS5wYXJlbnRzKTtcclxuICAgIGNvbnN0IGZpbGUgPSBhd2FpdCBkcml2ZS5maWxlcy5jcmVhdGUoe1xyXG4gICAgICAgIHJlc291cmNlOiBmaWxlTWV0YWRhdGEsXHJcbiAgICAgICAgbWVkaWEsXHJcbiAgICAgICAgZmllbGRzOiAnaWQsIHdlYlZpZXdMaW5rJyxcclxuICAgIH0pO1xyXG4gICAgXHJcbmNvbnNvbGUubG9nKFwiQXJjaGl2byBzdWJpZG8gZXhpdG9zYW1lbnRlOlwiKTtcclxuY29uc29sZS5sb2coXCJJRCBkZWwgYXJjaGl2bzpcIiwgZmlsZS5kYXRhLmlkKTtcclxuY29uc29sZS5sb2coXCJOb21icmUgZGVsIGFyY2hpdm86XCIsIGZpbGUuZGF0YS5uYW1lKTtcclxuY29uc29sZS5sb2coXCJFbmxhY2UgcGFyYSB2ZXIgZWwgYXJjaGl2bzpcIiwgZmlsZS5kYXRhLndlYlZpZXdMaW5rKTtcclxuY29uc29sZS5sb2coXCJFbmxhY2UgcGFyYSBkZXNjYXJnYXIgZWwgYXJjaGl2bzpcIiwgZmlsZS5kYXRhLndlYkNvbnRlbnRMaW5rKTtcclxuYXdhaXQgZHJpdmUucGVybWlzc2lvbnMuY3JlYXRlKHtcclxuICAgIGZpbGVJZDogZmlsZS5kYXRhLmlkLFxyXG4gICAgcmVxdWVzdEJvZHk6IHtcclxuICAgICAgICByb2xlOiAncmVhZGVyJyxcclxuICAgICAgICB0eXBlOiAnYW55b25lJywgLy8gUGVybWl0ZSBxdWUgY3VhbHF1aWVyYSBjb24gZWwgZW5sYWNlIGxvIHZlYVxyXG4gICAgfSxcclxufSk7XHJcblxyXG4gICAgLy8gRGV2dWVsdmUgZWwgZW5sYWNlIHDDumJsaWNvIGFsIGFyY2hpdm9cclxuICAgIHJldHVybiBmaWxlLmRhdGEuaWQ7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGFzeW5jIGZ1bmN0aW9uIGhhbmRsZXIocmVxLCByZXMpIHtcclxuICAgIGlmIChyZXEubWV0aG9kID09PSAnUE9TVCcpIHtcclxuICAgICAgICBjb25zdCBmb3JtID0gZm9ybWlkYWJsZSh7XHJcbiAgICAgICAgICAgIHVwbG9hZERpcjogdGVtcERpciwgLy8gRGlyZWN0b3JpbyB0ZW1wb3JhbFxyXG4gICAgICAgICAgICBrZWVwRXh0ZW5zaW9uczogdHJ1ZSwgLy8gTWFudGVuZXIgZXh0ZW5zaW9uZXNcclxuICAgICAgICB9KTtcclxuICAgICAgICBcclxuICAgICAgICBmb3JtLnBhcnNlKHJlcSwgYXN5bmMgKGVyciwgZmllbGRzLCBmaWxlcykgPT4ge1xyXG4gICAgICAgICAgICBpZiAoZXJyKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWwgcHJvY2VzYXIgZWwgYXJjaGl2bzpcIiwgZXJyKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJFcnJvciBhbCBwcm9jZXNhciBlbCBhcmNoaXZvXCIgfSk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHRyeSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCB7IG5vbWJyZW1hdGVyaWEsIG5vbWJyZWN1cnNvLCBub21icmVtYXRlcmlhbCwgdGlwbywgZGVzY3JpcGNpb24sIGZlY2hhLCBjYXRlZ29yaWEgLHRva2VufSA9IGZpZWxkcztcclxuICAgICAgICAgICAgICAgIGlmKHRva2VuWzBdID09IG51bGwpe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibm8gZXN0YSBsb2dlYWRvXCIpXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBcIkRlYmUgbG9nZWFyc2UgcGFyYSBzdWJpciBhcmNoaXZvc1wiIH0pO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCJBQVNEQVNERFNcIik7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBkZWNvZGVkID0gand0LnZlcmlmeSh0b2tlblswXSwgU0VDUkVUX0tFWSk7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGRlY29kZWQucGVybWlzb3MpO1xyXG4gICAgICAgICAgICAgICAgLy8gbm8gc2UgcHJvZ3JhbWFyXHJcbiAgICAgICAgICAgICAgICBpZihkZWNvZGVkLnBlcm1pc29zID09IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInBlcm1pc29zID0gMFwiKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZihkZWNvZGVkLnBlcm1pc29zID09IDEpe1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicGVybWlzb3MgPSAxXCIpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIm5vXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJEZWJlIGxvZ2VhcnNlIHBhcmEgc3ViaXIgYXJjaGl2b3NcIiB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCJleGl0b1wiKTtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZXhpdG9cIik7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW5vbWJyZW1hdGVyaWEgfHwgIW5vbWJyZWN1cnNvIHx8ICFub21icmVtYXRlcmlhbCB8fCAhdGlwbyB8fCAhZGVzY3JpcGNpb24gfHwgIWZlY2hhIHx8ICFjYXRlZ29yaWEgfHwgIWZpbGVzLmFyY2hpdm8pIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiVG9kb3MgbG9zIGNhbXBvcyBzb24gb2JsaWdhdG9yaW9zXCIgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImV4aXRvMjJcIik7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBhcmNoaXZvU3ViaWRvID0gZmlsZXMuYXJjaGl2b1swXTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoID0gYXJjaGl2b1N1Ymlkby5maWxlcGF0aDsgLy8gUnV0YSBkZWwgYXJjaGl2byB0ZW1wb3JhbFxyXG4gICAgICAgICAgICAgICAgY29uc3QgcmFuZG9tRmlsZU5hbWUgPSBgJHtEYXRlLm5vdygpfS0ke2FyY2hpdm9TdWJpZG8ub3JpZ2luYWxGaWxlbmFtZX1gO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAvLyBTdWJpciBhcmNoaXZvIGEgR29vZ2xlIERyaXZlXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgLy8gQ29uZWN0YXIgYSBsYSBiYXNlIGRlIGRhdG9zXHJcbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhYmFzZSA9IGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKCk7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBtYXRlcmlhc0NvbGxlY3Rpb24gPSBkYXRhYmFzZS5jb2xsZWN0aW9uKFwibWF0ZXJpYWxcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gVmFsaWRhciBtYXRlcmlhIHkgY3Vyc29cclxuICAgICAgICAgICAgICAgIGNvbnN0IG1hdGVyaWEgPSBhd2FpdCBtYXRlcmlhc0NvbGxlY3Rpb24uZmluZE9uZSh7IG5vbWJyZW1hdGVyaWE6IG5vbWJyZW1hdGVyaWFbMF0gfSk7XHJcbiAgICAgICAgICAgICAgICBpZiAoIW1hdGVyaWEpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIk1hdGVyaWEgbm8gZW5jb250cmFkb1wiKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiTWF0ZXJpYSBubyBlbmNvbnRyYWRhXCIgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgY29uc3QgY3Vyc28gPSBhd2FpdCBtYXRlcmlhc0NvbGxlY3Rpb24uZmluZE9uZSh7XHJcbiAgICAgICAgICAgICAgICAgICAgXCJub21icmVtYXRlcmlhXCI6IG5vbWJyZW1hdGVyaWFbMF0sXHJcbiAgICAgICAgICAgICAgICAgICAgXCJjdXJzb3Mubm9tYnJlY3Vyc29cIjogbm9tYnJlY3Vyc29bMF0sXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAoIWN1cnNvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJDdXJzbyBubyBlbmNvbnRyYWRvXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogXCJDdXJzbyBubyBlbmNvbnRyYWRvXCIgfSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgLy8gT2J0ZW5lciBjb250ZW8gYWN0dWFsIGRlIG1hdGVyaWFsZXNcclxuICAgICAgICAgICAgICAgIGNvbnN0IGNvbnRlbyA9IGF3YWl0IG1hdGVyaWFzQ29sbGVjdGlvbi5hZ2dyZWdhdGUoW1xyXG4gICAgICAgICAgICAgICAgICAgIHsgJG1hdGNoOiB7IFwibm9tYnJlbWF0ZXJpYVwiOiBub21icmVtYXRlcmlhWzBdIH0gfSxcclxuICAgICAgICAgICAgICAgICAgICB7ICR1bndpbmQ6IFwiJGN1cnNvc1wiIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgeyAkbWF0Y2g6IHsgXCJjdXJzb3Mubm9tYnJlY3Vyc29cIjogbm9tYnJlY3Vyc29bMF0gfSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHsgJHVud2luZDogXCIkY3Vyc29zLm1hdGVyaWFsZXNcIiB9LFxyXG4gICAgICAgICAgICAgICAgICAgIHsgJGNvdW50OiBcInRvdGFsX21hdGVyaWFsZXNcIiB9LFxyXG4gICAgICAgICAgICAgICAgXSkudG9BcnJheSgpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgdG90YWxudW1lcm8gPSBjb250ZW8ubGVuZ3RoID4gMCA/IGNvbnRlb1swXS50b3RhbF9tYXRlcmlhbGVzIDogMDtcclxuXHJcbiAgICAgICAgICAgICAgICBjb25zdCBnb29nbGVEcml2ZUxpbmsgPSBhd2FpdCB1cGxvYWRUb0dvb2dsZURyaXZlKGZpbGVQYXRoLCByYW5kb21GaWxlTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAvLyBDcmVhciBlbCBudWV2byBtYXRlcmlhbFxyXG4gICAgICAgICAgICAgICAgY29uc3QgbnVldm9NYXRlcmlhbCA9IHtcclxuICAgICAgICAgICAgICAgICAgICBpZG1hdGVyaWFsOiB0b3RhbG51bWVybyArIDEsXHJcbiAgICAgICAgICAgICAgICAgICAgbm9tYnJlbWF0ZXJpYWw6IG5vbWJyZW1hdGVyaWFsWzBdLFxyXG4gICAgICAgICAgICAgICAgICAgIHRpcG86IHRpcG9bMF0sXHJcbiAgICAgICAgICAgICAgICAgICAgZGVzY3JpcGNpb246IGRlc2NyaXBjaW9uWzBdLFxyXG4gICAgICAgICAgICAgICAgICAgIGZlY2hhOiBmZWNoYVswXSxcclxuICAgICAgICAgICAgICAgICAgICBhcHJvdmFkbzogZmFsc2UsXHJcbiAgICAgICAgICAgICAgICAgICAgaWRtYXRlcmlhOiBtYXRlcmlhLmlkbWF0ZXJpYSxcclxuICAgICAgICAgICAgICAgICAgICBydXRhOiBnb29nbGVEcml2ZUxpbmssIC8vIEVubGFjZSBnZW5lcmFkbyBwb3IgR29vZ2xlIERyaXZlXHJcbiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcmlhOiBjYXRlZ29yaWFbMF0sXHJcbiAgICAgICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgICAgIC8vIEHDsWFkaXIgZWwgbWF0ZXJpYWwgYSBsYSBiYXNlIGRlIGRhdG9zXHJcbiAgICAgICAgICAgICAgICBjb25zdCBhbmFkaXIgPSBhd2FpdCBtYXRlcmlhc0NvbGxlY3Rpb24udXBkYXRlT25lKFxyXG4gICAgICAgICAgICAgICAgICAgIHsgXCJub21icmVtYXRlcmlhXCI6IG5vbWJyZW1hdGVyaWFbMF0sIFwiY3Vyc29zLm5vbWJyZWN1cnNvXCI6IG5vbWJyZWN1cnNvWzBdIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgeyAkcHVzaDogeyBcImN1cnNvcy4kLm1hdGVyaWFsZXNcIjogbnVldm9NYXRlcmlhbCB9IH1cclxuICAgICAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyNcXG5cXG5cXG5cXG5cXG5cIik7XHJcblxyXG5cclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCJTT0xJQ0lUVURcIik7XHJcblxyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcIiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjXFxuXFxuXFxuXFxuXFxuXCIpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGFuYWRpci5tb2RpZmllZENvdW50ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJNYXRlcmlhbCBhZ3JlZ2FkbyBleGl0b3NhbWVudGVcIixcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWF0ZXJpYWw6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5vbWJyZW1hdGVyaWFsLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlwbyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXBjaW9uLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmVjaGEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXRlZ29yaWEsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBydXRhOiBnb29nbGVEcml2ZUxpbmssXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRXJyb3IgYWwgYcOxYWRpciBtYXRlcmlhbFwiIH0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgYWwgYWdyZWdhciBtYXRlcmlhbDpcIiwgZXJyb3IpO1xyXG4gICAgICAgICAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IFwiRXJyb3IgaW50ZXJubyBkZWwgc2Vydmlkb3JcIiB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICByZXMuc3RhdHVzKDQwNSkuanNvbih7IGVycm9yOiAnTcOpdG9kbyBubyBwZXJtaXRpZG8nIH0pO1xyXG4gICAgfVxyXG59XHJcbiJdLCJuYW1lcyI6WyJmb3JtaWRhYmxlIiwicGF0aCIsImZzIiwiTW9uZ29DbGllbnQiLCJnb29nbGUiLCJqd3QiLCJTRUNSRVRfS0VZIiwiY29uZmlnIiwiYXBpIiwiYm9keVBhcnNlciIsInVyaSIsImNsaWVudCIsImRiIiwidGVtcERpciIsImpvaW4iLCJwcm9jZXNzIiwiY3dkIiwiZXhpc3RzU3luYyIsIm1rZGlyU3luYyIsInJlY3Vyc2l2ZSIsImF1dGgiLCJHb29nbGVBdXRoIiwia2V5RmlsZSIsInNjb3BlcyIsImRyaXZlIiwidmVyc2lvbiIsImNvbm5lY3RUb0RhdGFiYXNlIiwiY29ubmVjdCIsImNvbnNvbGUiLCJsb2ciLCJ1cGxvYWRUb0dvb2dsZURyaXZlIiwiZmlsZVBhdGgiLCJmaWxlTmFtZSIsImZpbGVNZXRhZGF0YSIsIm5hbWUiLCJwYXJlbnRzIiwibWVkaWEiLCJtaW1lVHlwZSIsImJvZHkiLCJjcmVhdGVSZWFkU3RyZWFtIiwiZmlsZSIsImZpbGVzIiwiY3JlYXRlIiwicmVzb3VyY2UiLCJmaWVsZHMiLCJkYXRhIiwiaWQiLCJ3ZWJWaWV3TGluayIsIndlYkNvbnRlbnRMaW5rIiwicGVybWlzc2lvbnMiLCJmaWxlSWQiLCJyZXF1ZXN0Qm9keSIsInJvbGUiLCJ0eXBlIiwiaGFuZGxlciIsInJlcSIsInJlcyIsIm1ldGhvZCIsImZvcm0iLCJ1cGxvYWREaXIiLCJrZWVwRXh0ZW5zaW9ucyIsInBhcnNlIiwiZXJyIiwiZXJyb3IiLCJzdGF0dXMiLCJqc29uIiwic3VjY2VzcyIsIm5vbWJyZW1hdGVyaWEiLCJub21icmVjdXJzbyIsIm5vbWJyZW1hdGVyaWFsIiwidGlwbyIsImRlc2NyaXBjaW9uIiwiZmVjaGEiLCJjYXRlZ29yaWEiLCJ0b2tlbiIsImRlY29kZWQiLCJ2ZXJpZnkiLCJwZXJtaXNvcyIsImFyY2hpdm8iLCJhcmNoaXZvU3ViaWRvIiwiZmlsZXBhdGgiLCJyYW5kb21GaWxlTmFtZSIsIkRhdGUiLCJub3ciLCJvcmlnaW5hbEZpbGVuYW1lIiwiZGF0YWJhc2UiLCJtYXRlcmlhc0NvbGxlY3Rpb24iLCJjb2xsZWN0aW9uIiwibWF0ZXJpYSIsImZpbmRPbmUiLCJjdXJzbyIsImNvbnRlbyIsImFnZ3JlZ2F0ZSIsIiRtYXRjaCIsIiR1bndpbmQiLCIkY291bnQiLCJ0b0FycmF5IiwidG90YWxudW1lcm8iLCJsZW5ndGgiLCJ0b3RhbF9tYXRlcmlhbGVzIiwiZ29vZ2xlRHJpdmVMaW5rIiwibnVldm9NYXRlcmlhbCIsImlkbWF0ZXJpYWwiLCJhcHJvdmFkbyIsImlkbWF0ZXJpYSIsInJ1dGEiLCJhbmFkaXIiLCJ1cGRhdGVPbmUiLCIkcHVzaCIsIm1vZGlmaWVkQ291bnQiLCJtZXNzYWdlIiwibWF0ZXJpYWwiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(api)/./pages/api/agregar.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../webpack-api-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(api)/./node_modules/next/dist/build/webpack/loaders/next-route-loader/index.js?kind=PAGES_API&page=%2Fapi%2Fagregar&preferredRegion=&absolutePagePath=.%2Fpages%5Capi%5Cagregar.js&middlewareConfigBase64=e30%3D!")));
module.exports = __webpack_exports__;

})();